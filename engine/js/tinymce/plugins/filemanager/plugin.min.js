tinymce.PluginManager.add("filemanager", function (editor, url) {
	
    editor.on('init', function() {
		var cssURL = url + '/filemanager.css';
		if(document.createStyleSheet){
			document.createStyleSheet(cssURL);
		} else {
			cssLink = editor.dom.create('link', {
						rel: 'stylesheet',
						href: cssURL
						});
			document.getElementsByTagName('head')[0].
						appendChild(cssLink);
		}
    });

    var scriptLoader = new tinymce.dom.ScriptLoader(),
        fm;       

    scriptLoader.add(url + '/filemanager.js');

    scriptLoader.loadQueue(function () {
    	fm = new FileManager();

    });

	/* Add a button that opens a window */
    editor.ui.registry.addButton("filemanager", {
        tooltip:'File manager',
		icon : 'upload',
        onAction: function () {
            /* Open window */
            fm.open();
        },
    });
    /* Adds a menu item, which can then be included in any menu via the menu/menubar configuration */
    editor.ui.registry.addMenuItem("filemanager", {
        text: "File manager",
		icon : 'upload',
		context: 'insert',
        onAction: function () {
            /* Open window */
            fm.open();
        },
    });

    /* Return the metadata for the help plugin */
    return {
        getMetadata: function () {
            return {
                name: "File manager",
                url: "",
            };
        },
    };
});

tinymce.PluginManager.requireLangPack("filemanager", "ru");
